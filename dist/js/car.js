"use strict";var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _asyncToGenerator(e){return function(){var c=e.apply(this,arguments);return new Promise(function(s,r){return function t(e,n){try{var i=c[e](n),a=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});s(a)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var login=getCookie("login");login||(localStorage.setItem("url",location.href),location.href="../html/login.html");var Car=function(){function n(e,t){_classCallCheck(this,n),this.ele=document.querySelector(e),this.username=t,this.info={number:0,totalprice:0},this.init()}var e;return _createClass(n,[{key:"init",value:function(){var n=this;this.carttable=this.ele.querySelector(".cart-table"),this.sx=this.ele.querySelector(".shipping-num .highlight i"),this.zj=this.ele.querySelector(".shipping-num h5 i"),this.prices=this.ele.querySelector(".shipping-price .highlight i"),this.allChecked=this.ele.querySelector(".allChecked"),this.getData(),this.ele.onclick=function(t){n.id=t.target.getAttribute("idx"),t.target.classList.contains("checked")&&(n.data.forEach(function(e){e.id==n.id&&(e.is_select=t.target.checked)}),n.calculation()),t.target.classList.contains("allChecked")&&(n.data.forEach(function(e){e.is_select=t.target.checked}),n.render()),t.target.classList.contains("down")&&n.reduce(),t.target.classList.contains("up")&&n.add(),t.target.classList.contains("del")&&n.remove(n.id),t.target.classList.contains("settlement")&&n.data.filter(function(e){return 1==e.is_select}).forEach(function(e){n.remove(e.goods_id)})}}},{key:"getData",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pAjax({url:"../api/getcarData.php",data:{username:this.username}});case 2:t=e.sent,this.data=JSON.parse(t),this.data.forEach(function(e){e.is_select=!1}),this.render();case 6:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"render",value:function(){this.calculation();var n="",i="",a="";this.data.forEach(function(e){var t=e.price.split("￥")[1].replace(",","")*e.goods_num;i=+i+e.price.split("￥")[1].replace(",","")*e.goods_num*1,n+='\n            <div class="item-list have-margin">\n            <div class="cart-group">\n                    <div class="cart-items">\n                        <div class="cart-item">\n                            <div class="checkbox">\n                            <input type="checkbox" '+(e.is_select?"checked":"")+' class="checked checkbox-on" idx="'+e.id+'">\n                            </div>\n                            <div class="item-wrapper">\n                                <div class="items-thumb">\n                                    <img src="'+e.img+'" alt="">\n                                </div>\n                                <div class="name hide-row">\n                                    <div class="name-table">\n                                        <a >'+e.title+"</a>\n                                        <ul><li>"+e.color+'</li></ul>\n                                    </div>\n                                </div>\n                                <div class="operation">\n                                    <a  class="del" idx="'+e.id+'"></a>\n                                </div>\n                                <div class="">\n                                    <div class="subtotal">\n                                        <p class="discount">\n                                            <i>￥</i>\n                                            <span>'+t+'</span>\n                                        </p>\n                                    </div>\n                                    <div class="item-cols-num">\n                                        <div class="quanity">\n                                            <span class="button down" idx="'+e.id+'">-</span>\n                                            <span class="num">\n                                                '+e.goods_num+'\n                                            </span>\n                                            <span class="button up" idx="'+e.id+'">+</span>\n                                        </div>\n                                    </div>\n                                    <div class="price">'+e.price.split("￥")[1].replace(",","")+"</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n            </div>\n        </div>\n            ",a=+e.goods_num+ +a}),console.log(a),this.carttable.innerHTML=n,this.zj.innerHTML=a,this.down=document.querySelectorAll(".down"),this.up=document.querySelectorAll(".up"),this.goodnum=document.querySelectorAll(".num"),this.goodnum.forEach(function(e){"1"!=e.innerHTML&&(e.previousElementSibling.style.backgroundPosition="-1px -59px",e.previousElementSibling.style.cursor="pointer")}),this.up.forEach(function(e){e.onmouseover=function(){e.style.backgroundPosition="-1px -119px"},e.onmouseout=function(){e.style.backgroundPosition="-1px -1px"}})}},{key:"calculation",value:function(){this.selectdata=this.data.filter(function(e){return 1==e.is_select}),this.info.number=this.selectdata.reduce(function(e,t){return e+ +t.goods_num},0),this.info.totalprice=this.selectdata.reduce(function(e,t){return e+t.price.split("￥")[1].replace(",","")*t.goods_num},0);var e=this.data.every(function(e){return 1==e.is_select});this.sx.innerHTML=this.info.number,this.prices.innerHTML=this.info.totalprice,this.allChecked.checked=e}},{key:"reduce",value:function(){var t=this,n=this.data.find(function(e){return e.id==t.id}).goods_num;n<=1?alert("商品数量最小为1"):pAjax({url:"../api/updatacar.php",data:{goods_id:this.id,goods_num:--n,username:this.username}}).then(function(e){(e=JSON.parse(e)).code&&t.data.forEach(function(e){e.id==t.id&&(e.goods_num=n,t.render())})})}},{key:"add",value:function(){var t=this,n=this.data.find(function(e){return e.id==t.id}).goods_num;pAjax({url:"../api/updatacar.php",data:{goods_id:this.id,goods_num:++n,username:this.username}}).then(function(e){(e=JSON.parse(e)).code&&t.data.forEach(function(e){e.id==t.id&&(e.goods_num=n,t.render())})})}},{key:"remove",value:function(t){var n=this;pAjax({url:"../api/deletecar.php",data:{username:this.username,goods_id:t}}).then(function(e){(e=JSON.parse(e)).code&&(n.data=n.data.filter(function(e){return e.id!=t}),n.render())})}}]),n}();new Car("#app",login);